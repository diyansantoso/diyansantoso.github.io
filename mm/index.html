<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Math Practice Drills</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b1220;
      --panel:#0f172a;
      --text:#e5e7eb;
      --muted:#9aa4b2;
      --accent:#22d3ee;
      --accent-2:#3b82f6;
      --border:rgba(148,163,184,.18);
      --ok:#10b981;
      --warn:#f59e0b;
      --bad:#ef4444;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      line-height:1.5;
      display:flex; align-items:center; justify-content:center;
    }
    .wrap{
      width:min(860px, 96vw);
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
      border:1px solid var(--border);
      border-radius:20px; padding:20px;
    }
    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:16px;
    }
    .title{
      font-size:clamp(22px, 2.8vw, 30px); font-weight:800; letter-spacing:.2px;
      background:linear-gradient(135deg, var(--accent), var(--accent-2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .muted{ color:var(--muted); font-size:clamp(12px,1.6vw,14px) }

    .controls{
      display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin:12px 0 6px;
    }
    @media (max-width:720px){ .controls{ grid-template-columns:1fr; } }

    .control{
      border:1px solid var(--border); border-radius:12px; padding:12px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    }
    label{ font-weight:700; font-size:clamp(14px,1.8vw,16px) }
    select, input[type="number"]{
      width:100%; background:transparent; border:none; outline:none; color:var(--text);
      font-size:clamp(16px,2vw,18px);
    }

    .btn{
      appearance:none; border:1px solid var(--border); color:var(--text);
      background:linear-gradient(135deg, rgba(34,211,238,.2), rgba(59,130,246,.14));
      padding:12px 16px; border-radius:12px; font-weight:800; font-size:clamp(16px,2.2vw,18px);
      cursor:pointer; transition:transform .05s ease, border-color .2s ease, opacity .2s ease;
    }
    .btn:hover{ border-color:rgba(34,211,238,.6) }
    .btn:active{ transform:translateY(1px) }
    .btn.secondary{
      background:transparent; border-color:var(--border); font-weight:700;
    }

    .status{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      border:1px solid var(--border); border-radius:12px; padding:12px; margin:14px 0 6px;
    }
    .stat{
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      flex:1; min-width:0;
    }
    .stat .label{ color:var(--muted); font-size:clamp(12px,1.6vw,14px) }
    .stat .value{ font-weight:900; font-size:clamp(18px,3vw,26px) }

    .quiz{
      border:1px solid var(--border); border-radius:16px; padding:18px;
      display:grid; gap:16px; margin-top:12px;
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015));
    }
    .problem{
      font-weight:900; text-align:center;
      font-size:clamp(34px, 6vw, 60px);
      letter-spacing:.5px;
    }
    .answer-row{
      display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap;
    }
    .input{
      font-size:clamp(24px, 4.5vw, 36px);
      padding:10px 14px; border-radius:12px; border:1px solid var(--border); background:transparent; color:var(--text);
      width:min(280px, 70vw); text-align:center; outline:none;
    }
    .feedback{
      text-align:center; min-height:1.4em; font-size:clamp(14px,2vw,16px);
    }
    .feedback.ok{ color:var(--ok) }
    .feedback.warn{ color:var(--warn) }
    .feedback.bad{ color:var(--bad) }

    .history{
      display:grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap:8px; margin-top:8px;
    }
    .pill{
      border:1px solid var(--border); border-radius:999px; padding:8px 12px;
      display:flex; align-items:center; justify-content:center; gap:8px;
      font-size:clamp(12px,1.8vw,14px);
      background:rgba(255,255,255,.02);
    }
    .pill.ok{ border-color:rgba(16,185,129,.4); color:#b6f3d9 }
    .pill.bad{ border-color:rgba(239,68,68,.4); color:#ffc4c4 }
    .pill.time{ border-color:rgba(245,158,11,.4); color:#ffe6b8 }

    .center{ display:flex; justify-content:center; gap:12px; flex-wrap:wrap; margin-top:8px; }
    .hidden{ display:none !important; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">Math Practice Drills</div>
        <div class="muted">Improve speed and accuracy with timed quizzes</div>
      </div>
      <div class="center">
        <button id="btnStart" class="btn">Start</button>
        <button id="btnStop" class="btn secondary" disabled>Stop</button>
      </div>
    </header>

    <section class="controls">
      <div class="control">
        <label for="difficulty">Difficulty</label>
        <select id="difficulty" aria-label="Select difficulty">
          <option value="easy">Easy (0–10)</option>
          <option value="medium">Medium (0–50)</option>
          <option value="hard">Hard (0–99)</option>
          <option value="custom">Custom</option>
        </select>
      </div>
      <div class="control" id="customRange" style="display:none">
        <label for="maxVal">Max Number</label>
        <input type="number" id="maxVal" min="5" max="9999" value="100" />
      </div>
      <div class="control">
        <label for="ops">Operations</label>
        <select id="ops" multiple size="4" aria-label="Select operations">
          <option value="+">Addition (+)</option>
          <option value="-">Subtraction (-)</option>
          <option value="x">Multiplication (×)</option>
          <option value="/">Division (÷)</option>
        </select>
      </div>
    </section>

    <section class="status" aria-live="polite">
      <div class="stat">
        <div class="label">Timer</div>
        <div class="value" id="timeLeft">—</div>
      </div>
      <div class="stat">
        <div class="label">Score</div>
        <div class="value"><span id="score">0</span> / <span id="total">0</span></div>
      </div>
      <div class="stat">
        <div class="label">Streak</div>
        <div class="value" id="streak">0</div>
      </div>
      <div class="stat">
        <div class="label">Accuracy</div>
        <div class="value" id="accuracy">0%</div>
      </div>
    </section>

    <section class="quiz">
      <div id="problem" class="problem">Press Start</div>
      <div class="answer-row">
        <input id="answer" class="input" type="number" inputmode="numeric" placeholder="Your answer" disabled />
        <button id="btnSubmit" class="btn" disabled>Submit</button>
      </div>
      <div id="feedback" class="feedback"></div>
      <div id="history" class="history"></div>
      <div class="center">
        <button id="btnSkip" class="btn secondary" disabled>Skip</button>
        <button id="btnNext" class="btn secondary hidden">Next</button>
        <button id="btnAddTime" class="btn secondary" disabled>+30s</button>
      </div>
    </section>
  </div>

  <script>
    // State
    const state = {
      running: false,
      seconds: 60, // default quiz length
      timerId: null,
      score: 0,
      total: 0,
      streak: 0,
      ops: new Set(["+","-","x","/"]),
      max: 10,
      current: null, // {a,b,op,ans,display}
    };

    // Elements
    const difficultyEl = document.getElementById("difficulty");
    const customRangeEl = document.getElementById("customRange");
    const maxValEl = document.getElementById("maxVal");
    const opsEl = document.getElementById("ops");

    const btnStart = document.getElementById("btnStart");
    const btnStop = document.getElementById("btnStop");
    const btnSubmit = document.getElementById("btnSubmit");
    const btnSkip = document.getElementById("btnSkip");
    const btnNext = document.getElementById("btnNext");
    const btnAddTime = document.getElementById("btnAddTime");

    const timeLeftEl = document.getElementById("timeLeft");
    const scoreEl = document.getElementById("score");
    const totalEl = document.getElementById("total");
    const streakEl = document.getElementById("streak");
    const accuracyEl = document.getElementById("accuracy");

    const problemEl = document.getElementById("problem");
    const answerEl = document.getElementById("answer");
    const feedbackEl = document.getElementById("feedback");
    const historyEl = document.getElementById("history");

    // Helpers
    function setDifficulty(){
      const val = difficultyEl.value;
      if (val === "easy") state.max = 10;
      if (val === "medium") state.max = 50;
      if (val === "hard") state.max = 99;
      if (val === "custom") {
        customRangeEl.style.display = "";
        state.max = clamp(parseInt(maxValEl.value || "100", 10), 5, 9999);
      } else {
        customRangeEl.style.display = "none";
      }
    }
    function clamp(x,min,max){ return Math.max(min, Math.min(max, x)); }
    function randInt(n){ return Math.floor(Math.random()* (n+1)); }

    function pickOp(){
      const a = Array.from(state.ops);
      if (!a.length) return "+";
      return a[Math.floor(Math.random()*a.length)];
    }

    function generateProblem(){
      const op = pickOp();
      let a = randInt(state.max), b = randInt(state.max);
      // Tweak for division: ensure integer results; avoid divide by zero.
      if (op === "/"){
        b = clamp(randInt(state.max), 1, state.max) || 1;
        const q = randInt(Math.floor(state.max / b)) || 1;
        a = b * q;
      }
      // Avoid negative results for subtraction on easy/medium
      if (op === "-" && (difficultyEl.value !== "hard" && difficultyEl.value !== "custom")){
        if (b > a) [a,b] = [b,a];
      }
      const ans = compute(a,b,op);
      const display = `${a} ${symbol(op)} ${b} = ?`;
      state.current = {a,b,op,ans,display};
      problemEl.textContent = display;
      answerEl.value = "";
      answerEl.focus();
      btnNext.classList.add("hidden");
      feedback("");
    }

    function compute(a,b,op){
      if (op === "+") return a + b;
      if (op === "-") return a - b;
      if (op === "x") return a * b;
      if (op === "/") return Math.floor(a / b); // integer division
      return 0;
    }
    function symbol(op){
      return op === "x" ? "×" : (op === "/" ? "÷" : op);
    }

    function formatTime(s){
      const m = Math.floor(s/60), r = s%60;
      return `${m}:${r.toString().padStart(2,"0")}`;
    }

    function feedback(msg, cls){
      feedbackEl.textContent = msg || "";
      feedbackEl.className = "feedback" + (cls ? " " + cls : "");
    }

    function updateStats(){
      scoreEl.textContent = state.score;
      totalEl.textContent = state.total;
      streakEl.textContent = state.streak;
      const acc = state.total === 0 ? 0 : Math.round((state.score/state.total)*100);
      accuracyEl.textContent = `${acc}%`;
    }

    function addHistory(item){
      const pill = document.createElement("div");
      pill.className = "pill " + (item.type || "");
      pill.textContent = item.text;
      historyEl.prepend(pill);
      // limit history items
      while (historyEl.children.length > 18) historyEl.removeChild(historyEl.lastChild);
    }

    // Quiz control
    function startQuiz(){
      state.running = true;
      state.seconds = 60;
      state.score = 0; state.total = 0; state.streak = 0;
      updateStats();
      historyEl.innerHTML = "";
      timeLeftEl.textContent = formatTime(state.seconds);
      btnStart.disabled = true; btnStop.disabled = false;
      btnSubmit.disabled = false; btnSkip.disabled = false; btnAddTime.disabled = false;
      answerEl.disabled = false; answerEl.focus();
      generateProblem();
      state.timerId = setInterval(()=>{
        state.seconds--;
        timeLeftEl.textContent = formatTime(state.seconds);
        if (state.seconds <= 0){
          stopQuiz();
        }
      },1000);
    }

    function stopQuiz(){
      if (!state.running) return;
      state.running = false;
      clearInterval(state.timerId);
      timeLeftEl.textContent = formatTime(Math.max(0, state.seconds));
      btnStart.disabled = false; btnStop.disabled = true;
      btnSubmit.disabled = true; btnSkip.disabled = true; btnAddTime.disabled = true;
      answerEl.disabled = true;
      feedback(`Time's up! Score: ${state.score}/${state.total}`, state.score/state.total >= 0.7 ? "ok" : "bad");
      problemEl.textContent = "Press Start";
    }

    function submitAnswer(){
      if (!state.running || !state.current) return;
      const val = Number(answerEl.value);
      if (Number.isNaN(val) || answerEl.value.trim() === ""){
        feedback("Enter an answer", "warn");
        return;
      }
      state.total++;
      if (val === state.current.ans){
        state.score++; state.streak++;
        feedback("Correct!", "ok");
        addHistory({ type:"ok", text:`${state.current.a} ${symbol(state.current.op)} ${state.current.b} = ${val}` });
        btnNext.classList.remove("hidden");
        generateProblem();
      } else {
        state.streak = 0;
        feedback(`Incorrect. Answer: ${state.current.ans}`, "bad");
        addHistory({ type:"bad", text:`${state.current.a} ${symbol(state.current.op)} ${state.current.b} ≠ ${val} → ${state.current.ans}` });
        btnNext.classList.remove("hidden");
        generateProblem();
      }
      updateStats();
    }

    // Events
    difficultyEl.addEventListener("change", () => {
      setDifficulty();
      if (difficultyEl.value === "custom") maxValEl.focus();
    });
    maxValEl.addEventListener("input", () => {
      state.max = clamp(parseInt(maxValEl.value || "100", 10), 5, 9999);
    });
    opsEl.addEventListener("change", () => {
      const chosen = Array.from(opsEl.selectedOptions).map(o => o.value);
      state.ops = new Set(chosen.length ? chosen : ["+"]); // ensure at least one
    });

    btnStart.addEventListener("click", startQuiz);
    btnStop.addEventListener("click", stopQuiz);
    btnSubmit.addEventListener("click", submitAnswer);
    btnSkip.addEventListener("click", () => {
      if (!state.running) return;
      addHistory({ type:"time", text:`Skipped: ${state.current.a} ${symbol(state.current.op)} ${state.current.b}` });
      state.total++; state.streak = 0; updateStats();
      generateProblem();
      feedback("Skipped", "warn");
    });
    btnNext.addEventListener("click", () => {
      if (!state.running) return;
      generateProblem();
      btnNext.classList.add("hidden");
    });
    btnAddTime.addEventListener("click", () => {
      if (!state.running) return;
      state.seconds += 30;
      timeLeftEl.textContent = formatTime(state.seconds);
      addHistory({ type:"time", text:"+30s added" });
    });

    answerEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") submitAnswer();
    });

    // Keyboard shortcuts
    document.addEventListener("keydown", (e) => {
      if (["INPUT", "SELECT", "TEXTAREA"].includes(document.activeElement.tagName)) return;
      if (e.key.toLowerCase() === "s" && !state.running) startQuiz();
      if (e.key.toLowerCase() === "x" && state.running) stopQuiz();
    });

    // Defaults
    // Preselect all operations
    for (const opt of opsEl.options) opt.selected = true;
    setDifficulty();
    updateStats();
    timeLeftEl.textContent = "1:00";
  </script>
</body>
</html>